/* 
 mw-sdk v1.0.1
 2015-08-24
 Copyright 2015, magicwindow.cn
 */
function Module(a,b){this.name=a,this.action=b,modules[a]=this,this.init()}var modules={},moduleFans={};Module.prototype={init:function(){var a=moduleFans;this.stats=0,this.depsStats={},this.fixAction(),this.deps.forEach(function(b){a[b]=a[b]||{},a[b][this.name]=!0}),this.instance=this.execute(),this.notify()},fixAction:function(){var a=this.action,b=this.getFuncParamHolders(a);"function"==typeof a&&(this.action=b.concat(a)),this.deps=this.action.length>1?this.action.slice(0,this.action.length):[]},getFuncParamHolders:function(a){var b,c,d,e;if("function"==typeof a){if(b=a.toString(),c=/function\s*\w*\s*\((.*)\)\s*\{/,d=b.match(c))return e=d[1].replace(/\s*/,""),e.split(",")}else if(a&&a.constructor===Array)return a.slice(0,a.length-1)},execute:function(){var a=this.action,b=a.slice(0,a.length-1),c=a[a.length-1];return b.forEach(function(a,c){var d=modules[a];d&&(b[c]=d.execute())}),this.instance||(this.instance=c.apply(null,b),this.stats+=1),this.instance},checkDeps:function(){var a=!1;return this.deps.forEach(function(b){var c=modules[this.deps[b]];c&&c.checkDeps()!==!1||(a=!0)}),!a},notify:function(){var a=this.name,b=moduleFans[a];b&&b.length>0&&b.forEach(function(b){b.complete(a)})},complete:function(a){var b=this.checkDeps();b&&(this.stats+=1,this.execute())}},mw.module=function(a,b){if(b)return new Module(a,b);if(modules[a])return modules[a].execute();throw new Error("Module not found: "+a)},mw.module("m1",["m2","m3",function(a,b){return console.log(a,b),"MODULE-1"}]),mw.module("m2",["m3",function(a){return console.log(a),"MODULE-2"}]),mw.module("m3",[function(){return console.log("M3 is loaded!"),"MODULE-3"}]);var a=mw.module("m1");mw.extend(mw,{ajax:function(a){var b,c,d,e=mw.ajax.create(),f=this,g=0,h=a.filter,i=a.beforeSend,j=a.success||a.callback,k=a.error,l=a.complete,m=a.tries,n=a.target,o=a.timeout||1e5,p=a.url,q=a.method||a.type||"GET",r=a.xtra,s=a.dataType||"text",t=a.params||a.data;if(q=q.toLowerCase(),t){if("object"==typeof t){b=[];for(c in t)d=t[c],b.push(c+"="+("function"==typeof h?h.call(null,d):escape(d)));t=b.join("&")}"get"===q&&(p+=-1===p.indexOf("?")?"?"+t:"&"+t)}if(s&&"jsonp"===s.toLowerCase()){var u="ajax_cb_"+(new Date).getTime()+"_"+Math.floor(500*Math.random()),v=document.createElement("script");return p+=(-1===p.indexOf("?")?"?":"&")+"callback="+u,window[u]=function(a){"function"==typeof j&&j(a),delete window[u],document.head.removeChild(v)},o>0&&setTimeout(function(){window[u]},o),document.head.appendChild(v),void(v.src=p)}return e.open(q,p,!0),"post"===q?(e.setRequestHeader("Method","POST "+p+" HTTP/1.1"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded")):t=null,e.onreadystatechange=function(){if(4===e.readyState)if("function"==typeof l&&l.call(null),200===e.status){if("JSON"===s.toUpperCase()){var a=e.responseText;try{var b=new Function("return "+a)();b&&"function"==typeof j&&j.call(null,b,e,r)}catch(c){mw.isFunction(k)}return}n&&e.getResponseHeader("content-type").match(/(html|plain)/)&&f.parseHTML(n,e.responseText),"function"==typeof j&&j.call(null,!0,e,r)}else m>0?m>g&&(g++,e.abort(),e.send(t)):"function"==typeof k&&k.call(null,!1,e,r)},("function"!=typeof i||i.call(e)!==!1)&&e.send(t),e},get:function(a,b,c,d){return this.isFunction(b)&&(d=d||c,c=b,b=void 0),this.ajax({url:a,method:"GET",dataType:d,data:b,success:c})},post:function(a,b,c,d){return this.isFunction(b)&&(d=d||c,c=b,b=void 0),this.ajax({url:a,method:"POST",dataType:d,data:b,success:c})}}),mw.ajax.create=function(){var a;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){console.log(d)}}}return a};var configs={},readonlyList={};mw.namespace("mw.sdk"),mw.extend(mw,{config:function(a,b,c){return"undefined"!=typeof b?mw.config.set(a,b,c):"string"==typeof a?mw.config.get(a):"undefined"==typeof a?mw.extend({},configs):void 0},constant:function(a,b){return"undefined"==typeof b?mw.config(a):void mw.config(a,b,!0)},"var":function(a,b){return mw.config(a,b)}}),mw.config.set=function(a,b,c){return"string"==typeof a?(readonlyList[a]||(configs[a]=b,c===!0&&(readonlyList[a]=!0)),mw.config):void 0},mw.config.get=function(a){return a?configs[a]:void 0};var sdk=mw.sdk;sdk.connect=function(a){},sdk.initialized=!1,sdk.init=function(a){var b={server:"sdk.magicwindow.cn",appkey:"com.webapp.com"},c=mw.extend(b,a);for(var d in c)sdk.config(d,c[d])},sdk.onReady=function(a){};